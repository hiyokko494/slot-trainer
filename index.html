<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>スロット・ビタ押し練習</title>
  <style>
    body {
      background: #f5f5f5;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      margin: 0;
    }

    .machine {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .reel {
      width: 80px;
      height: 150px;
      border: 2px solid #333;
      overflow: hidden;
      position: relative;
      background: #fff;
    }

    .symbols {
      position: absolute;
      width: 100%;
      display: flex;
      flex-direction: column;
    }

    .symbol {
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: bold;
    }

    .blue { color: blue; }
    .red { color: red; }

    .buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .status {
      margin-top: 10px;
      font-size: 18px;
    }

    .success {
      color: green;
    }

    .fail {
      color: red;
    }
  </style>
</head>
<body>
  <h2>スロット・ビタ押し練習</h2>
  <div class="machine">
    <div class="reel"><div class="symbols" id="reel0"></div></div>
    <div class="reel"><div class="symbols" id="reel1"></div></div>
    <div class="reel"><div class="symbols" id="reel2"></div></div>
  </div>
  <div class="buttons">
    <button id="start">START</button>
    <button class="stop" data-index="0" disabled>STOP1</button>
    <button class="stop" data-index="1" disabled>STOP2</button>
    <button class="stop" data-index="2" disabled>STOP3</button>
  </div>
  <div class="status" id="status"></div>

  <script>
    const reels = [
      { id: 'reel0', symbol: '7', class: 'blue' },
      { id: 'reel1', symbol: 'BAR', class: '' },
      { id: 'reel2', symbol: '7', class: 'red' },
    ];

    const totalSymbols = 21;
    const visibleSymbols = 3;
    const symbolHeight = 50;
    const spinSpeed = 100;
    const displayOffset = (totalSymbols - visibleSymbols) * symbolHeight;

    let intervals = [];
    let startTimes = [];
    let stoppedPositions = [];

    function fillReel(index) {
      const container = document.getElementById(reels[index].id);
      container.innerHTML = '';
      for (let i = 0; i < totalSymbols; i++) {
        const div = document.createElement('div');
        div.classList.add('symbol');
        if (i === totalSymbols - 1) {
          div.textContent = reels[index].symbol;
          if (reels[index].class) div.classList.add(reels[index].class);
        } else {
          div.innerHTML = '&nbsp;';
        }
        container.appendChild(div);
      }
      container.style.top = `-${displayOffset}px`;
    }

    function startSpin(index) {
      const container = document.getElementById(reels[index].id);
      let pos = displayOffset;
      intervals[index] = setInterval(() => {
        pos += 5;
        if (pos >= totalSymbols * symbolHeight) pos = 0;
        container.style.top = `-${pos}px`;
      }, spinSpeed / 5);
    }

    function stopSpin(index) {
      clearInterval(intervals[index]);
      const container = document.getElementById(reels[index].id);
      const currentTop = parseInt(container.style.top) || 0;
      const offset = (totalSymbols - 1) * symbolHeight;
      let diff = (offset + currentTop) % (totalSymbols * symbolHeight);
      let distance = Math.round(diff / symbolHeight);
      if (distance === 0) {
        container.style.top = `-${offset}px`;
        document.getElementById('status').textContent += `リール${index + 1}：great! `;
        document.getElementById('status').className = 'success';
      } else {
        document.getElementById('status').textContent += `リール${index + 1}：${distance}コマ${diff > 0 ? '早い' : '遅い'}！ `;
        document.getElementById('status').className = 'fail';
      }
    }

    document.getElementById('start').onclick = () => {
      document.getElementById('status').textContent = '';
      for (let i = 0; i < reels.length; i++) {
        fillReel(i);
        startSpin(i);
        document.querySelectorAll('.stop')[i].disabled = false;
      }
    };

    document.querySelectorAll('.stop').forEach(btn => {
      btn.onclick = () => {
        const i = +btn.getAttribute('data-index');
        btn.disabled = true;
        stopSpin(i);
      };
    });

    window.onload = () => {
      for (let i = 0; i < reels.length; i++) {
        fillReel(i);
      }
    };
  </script>
</body>
</html>
