
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>スロットゲーム</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      background: #111;
      font-family: sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    .machine {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #222;
      padding: 20px;
      border-radius: 20px;
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
    }
    .reels {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    .reel-container {
      width: 100px;
      height: 300px;
      overflow: hidden;
      position: relative;
      border: 2px solid #fff;
      border-radius: 10px;
      background: #000;
    }
    .reel {
      position: absolute;
      width: 100%;
    }
    .symbol {
      width: 100%;
      height: 100px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 48px;
      font-weight: bold;
    }
    .symbol-blue7 { color: #3498db; }
    .symbol-bar { color: #fff; }
    .symbol-red7 { color: #e74c3c; }

    .buttons {
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .stop-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }
    .start-button {
      padding: 10px 20px;
      font-size: 18px;
      background: #2ecc71;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
    .result {
      margin-top: 10px;
      font-size: 20px;
      color: #fff;
    }
    .congrats-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0,0,0,0.8);
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .congrats-text {
      font-size: 48px;
      color: gold;
      margin-bottom: 20px;
    }
    .retry-button {
      padding: 10px 20px;
      font-size: 20px;
      background: #3498db;
      color: #fff;
      border: none;
      border-radius: 10px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="machine">
    <div class="reels">
      <div class="reel-container" id="reel1-container"><div class="reel" id="reel1"></div></div>
      <div class="reel-container" id="reel2-container"><div class="reel" id="reel2"></div></div>
      <div class="reel-container" id="reel3-container"><div class="reel" id="reel3"></div></div>
    </div>
    <div class="buttons">
      <div class="stop-buttons">
        <button class="start-button" id="start">START</button>
        <button class="start-button" id="stop1">STOP1</button>
        <button class="start-button" id="stop2">STOP2</button>
        <button class="start-button" id="stop3">STOP3</button>
      </div>
      <div class="result" id="result-text"></div>
    </div>
  </div>
  <div class="congrats-overlay" id="congrats">
    <div class="congrats-text">CONGRATULATION!</div>
    <button class="retry-button" onclick="window.location.reload()">もう1度チャレンジ！</button>
  </div>
</body>
</html>

<script>
  const symbols = [
    { class: "symbol-blue7", text: "7" },
    { class: "symbol-bar", text: "BAR" },
    { class: "symbol-red7", text: "7" }
  ];
  const totalSymbols = 21;
  const viewSymbols = 3;
  const symbolHeight = 100;
  let reels = [];
  let positions = [0, 0, 0];
  let intervals = [null, null, null];
  let stopped = [false, false, false];

  function createReelSymbols(type) {
    let reelHTML = "";
    for (let i = 0; i < totalSymbols; i++) {
      if (i === 0) {
        reelHTML += `<div class="symbol ${symbols[type].class}">${symbols[type].text}</div>`;
      } else {
        reelHTML += `<div class="symbol">&nbsp;</div>`;
      }
    }
    return reelHTML;
  }

  function updateReel(index) {
    positions[index] = (positions[index] + 1) % totalSymbols;
    const topPosition = positions[index] * symbolHeight;
    reels[index].style.top = topPosition + "px";
  }

  function stopReel(index) {
    if (intervals[index]) {
      clearInterval(intervals[index]);
      intervals[index] = null;

      const expectedPos = (totalSymbols - viewSymbols); // 下段基準
      const actualPos = positions[index];
      const delta = (expectedPos - actualPos + totalSymbols) % totalSymbols;

      let resultText = "";
      let color = "white";

      if (delta === 0) {
        resultText = "great!";
        color = "red";
      } else {
        resultText = delta < totalSymbols / 2 ? `${delta}コマ早い！` : `${(totalSymbols - delta)}コマ遅い！`;
        color = delta < totalSymbols / 2 ? "green" : "blue";
      }

      const result = document.createElement("div");
      result.textContent = resultText;
      result.style.color = color;
      result.style.fontWeight = "bold";
      result.style.marginTop = "5px";

      document.getElementById(`reel${index + 1}-container`).appendChild(result);
      stopped[index] = true;

      if (stopped.every(s => s)) {
        if (positions.every(p => p === expectedPos)) {
          document.getElementById("congrats").style.display = "flex";
        }
      }
    }
  }

  window.onload = function () {
    for (let i = 0; i < 3; i++) {
      reels[i] = document.getElementById(`reel${i + 1}`);
      reels[i].innerHTML = createReelSymbols(i);
      reels[i].style.top = (totalSymbols - viewSymbols) * symbolHeight + "px"; // 初期状態は下段に図柄
    }

    document.getElementById("start").onclick = function () {
      // 再スタート防止
      if (intervals.some(v => v !== null)) return;

      stopped = [false, false, false];
      document.querySelectorAll(".reel-container div div").forEach(e => e.remove());

      for (let i = 0; i < 3; i++) {
        intervals[i] = setInterval(() => updateReel(i), 1000 / totalSymbols);
      }
    };

    document.getElementById("stop1").onclick = () => stopReel(0);
    document.getElementById("stop2").onclick = () => stopReel(1);
    document.getElementById("stop3").onclick = () => stopReel(2);
  };
</script>
